import * as React from "react"
import { useEffect, useRef } from "react"
import { gsap } from "gsap"

interface RocketSVGProps extends React.SVGProps<SVGSVGElement> {
  onScrambleComplete?: () => void;
}

export const RocketSVG = ({ onScrambleComplete, ...props }: RocketSVGProps) => {
  const fireRef = useRef<SVGPathElement>(null);
  const rocketGroupRef = useRef<SVGGElement>(null);
  const wrapperRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (!fireRef.current || !rocketGroupRef.current || !wrapperRef.current) return;
  
    // Initial state  in the bottom center of the viewport
    gsap.set(wrapperRef.current, {
      visibility: "none",        // start hidden
      transformOrigin: "center",
      // top: "50%",
      // left: "50%",
      // xPercent: -50,
      // yPercent: -50,
    });   
    
    gsap.set(fireRef.current, {visibility: 'none', transformOrigin: "50% 50%", scaleX: 1, scaleY: 1, fill: 'orange' });
    
    // Create main timeline for sequence
    const mainTimeline = gsap.timeline();
    
    // 1. Wrapper appears with visibility and opacity
    mainTimeline.to(wrapperRef.current, {
      visibility: 'visible',
      opacity: 1,
      duration: .1,
      ease: "power1.inOut",
    }).to(fireRef.current, {
      duration: .15,
      yoyo: true,
      repeat: -1,
      scaleX: 1.5,
      scaleY: 1.25,
      fill: "#FF4500",
      ease: "power1.inOut",
      transformOrigin: "50% 50%",
    })
    
    // 3. Skew animation starts after fire scaling
    const skewTimeline = gsap.timeline({ repeat: -1 }); // 2 seconds after rocket appears
    // skewTimeline
    skewTimeline.to(rocketGroupRef.current, {
      duration: 0.8,
      skewX: 4,
      ease: "power1.inOut",
    })
    .to(rocketGroupRef.current, {
      duration: 0.8,
      skewX: -4,
      ease: "power1.inOut",
    })
    .to(rocketGroupRef.current, {
      duration: 0.8,
      skewX: 0,
      ease: "power1.inOut",
    });

    
    // 4. Movement animation with sine wave oscillation
    mainTimeline.to(wrapperRef.current, {
      duration: 3.5,
      y: "-120vh",
      ease: "power1.inOut",
    }); // Start movement 4 seconds after rocket appears
    
    // Add sine wave oscillation
    mainTimeline.to(wrapperRef.current, {
      duration: 2,
      repeat: -1,
      yoyo: true,
      x: "+=200px",
      ease: "sine.inOut",
    }, 1); // Start oscillation when movement begins
    
    return () => {
      gsap.killTweensOf(fireRef.current);
      gsap.killTweensOf(rocketGroupRef.current);
      gsap.killTweensOf(wrapperRef.current);
      mainTimeline.kill();
      // skewTimeline.kill();
    };
  }, [onScrambleComplete]);

  return (
    <div ref={wrapperRef} className="z-[20]" style={{ visibility: 'hidden', position: 'absolute', top: '105%', left: '50%', transform: 'translate(-50%, -50%)' }}>
      <svg 
        xmlns="http://www.w3.org/2000/svg" 
        viewBox="0 0 2500 2500"
        fill="none"
        preserveAspectRatio="xMidYMid meet"
        {...props}
      >
      {/* Rocket Group - all parts except fire */}
      <g ref={rocketGroupRef}>
        {/* Main Body */}
        <path
          fill="var(--primary-color, #7DB9E8)"
          d="M1249.8 210.046c105.907 72.786 198.803 203.152 240.106 326.375 69.302 177.094 79.493 393.51 58.775 581.367-1.87 16.948-20.327 140.434-20.034 142.04l188.818 276.949-.034 217.582c-.005 36.86-.806 73.877.034 110.718-28.389-21.098-275.6-215.571-288.94-215.59-1.763 22.5-9.297 43.046-16.016 64.423h-128.398v32.96h-70.757c.293-10.977.85-21.998 0-32.96-36.143.952-87.017 2.48-122.744 0-7.461-21.343-14.795-42.212-19.321-64.424-6.197 4.405-11.768 10.762-17.945 15.523l-80.039 60.708c-62.88 47.412-127.217 92.851-190.771 139.36l.122-247.539c-.205-102.09-14.766-68.037 42.51-147.754l116.87-166.616c10.146-14.634 19.897-29.956 31.68-43.34 2.158-8.544-5.23-39.853-6.817-50.131-34.004-220.142-32.832-462.788 42.803-673.276 38.584-108.477 136.68-266.489 240.097-326.375Z"
        />
        {/* Nose and Wings */}
        <path
          fill="black"
          d="M973.715 1259.828c5.19 14.351 7.447 30.787 10.703 45.743l19.698 89.96c4.74 20.733 61.757 245.938 68.813 253.57l3.926.385h-5.566c-6.197 4.405-11.768 10.762-17.945 15.523l-80.039 60.708c-62.88 47.412-127.217 92.851-190.771 139.36l.122-247.539c-.205-102.09-14.766-68.037 42.51-147.754l116.87-166.616c10.146-14.634 19.897-29.956 31.68-43.34ZM1528.647 1259.828l188.818 276.949-.034 217.582c-.005 36.86-.806 73.877.034 110.718-28.389-21.098-275.6-215.571-288.94-215.59l2.24-.367c8.014-12.09 64.727-243.989 71.715-277.504 5.254-25.181 16.626-92.486 26.167-111.788ZM1249.8 210.046c105.907 72.786 198.803 203.152 240.106 326.375h-480.204c38.584-108.477 136.68-266.489 240.097-326.375Z"
        />
        {/* Tail */}
        <path
          fill="black"
          d="m1213.354 1649.486-.083-129.257c0-21.265-2.158-45.093 1.382-65.952 5.708-33.599 66.45-29.917 71.616 3.632 3.247 21.099 1.343 44.522 1.348 65.913l-.035 125.664 91.636-.068c16.318-.078 33.052-1.118 49.307.068-1.763 22.5-9.297 43.047-16.016 64.424h-128.398v32.96h-70.757c.293-10.977.85-21.998 0-32.96-36.143.952-87.017 2.48-122.744 0-7.461-21.343-14.795-42.212-19.321-64.424h5.566c45.478-.561 91.015-.048 136.499 0Z"
        />
        {/* Window */}
        <path
          fill="var(--secondary-color, #496899)"
          d="M1229.702 629.228q4.228-.508 8.476-.805 4.248-.298 8.506-.391 4.258-.088 8.51.034 4.258.117 8.507.45 4.243.326 8.466.864 4.224.542 8.418 1.284 4.19.747 8.34 1.699 4.155.947 8.252 2.104 4.097 1.153 8.135 2.51 4.038 1.353 8.003 2.905 3.965 1.553 7.851 3.296 3.882 1.744 7.676 3.677 3.794 1.934 7.49 4.053 3.692 2.119 7.276 4.419 3.589 2.295 7.055 4.765 3.467 2.476 6.807 5.113 3.345 2.641 6.553 5.44 3.208 2.802 6.274 5.756 3.067 2.954 5.982 6.055 2.915 3.105 5.678 6.347 2.76 3.243 5.357 6.617 2.597 3.374 5.029 6.87 2.427 3.496 4.678 7.11 2.256 3.612 4.326 7.333 2.075 3.72 3.96 7.54 1.89 3.813 3.584 7.719 1.7 3.906 3.203 7.89 1.499 3.985 2.808 8.038 1.303 4.052 2.407 8.168 1.103 4.112 2.002 8.272.898 4.165 1.592 8.364.693 4.204 1.181 8.433.489 4.228.762 8.481.278 4.248.347 8.506.068 4.258-.074 8.51-.141 4.259-.493 8.502-.351 4.243-.913 8.467-.561 4.218-1.328 8.408-.767 4.19-1.738 8.335-.972 4.145-2.149 8.237-1.172 4.097-2.549 8.125-1.376 4.028-2.949 7.988-1.567 3.955-3.335 7.832-1.762 3.877-3.716 7.662-1.953 3.779-4.091 7.465-2.139 3.682-4.453 7.256-2.32 3.574-4.805 7.027-2.49 3.457-5.147 6.782-2.656 3.33-5.473 6.523-2.818 3.194-5.786 6.245-2.974 3.052-6.09 5.952-3.12 2.9-6.371 5.645-3.257 2.744-6.646 5.322-3.388 2.583-6.9 4.995-3.51 2.408-7.133 4.644t-7.354 4.287q-3.73 2.056-7.558 3.92-3.828 1.871-7.74 3.546-3.915 1.68-7.91 3.159-3.989 1.484-8.051 2.769-4.058 1.279-8.179 2.363-4.116 1.084-8.281 1.963-4.17.879-8.374 1.548-4.204.673-8.438 1.137-4.204.46-8.427.718-4.224.254-8.453.303-4.233.049-8.462-.113-4.223-.156-8.442-.522-4.214-.366-8.403-.937-4.195-.572-8.35-1.343-4.16-.777-8.276-1.753-4.116-.982-8.179-2.158-4.067-1.177-8.066-2.554-4-1.372-7.93-2.944-3.93-1.568-7.778-3.326-3.843-1.762-7.603-3.706-3.755-1.948-7.412-4.072-3.657-2.129-7.207-4.434-3.55-2.3-6.977-4.775-3.433-2.475-6.744-5.112-3.305-2.642-6.48-5.44-3.173-2.798-6.205-5.747t-5.918-6.04q-2.886-3.095-5.615-6.328-2.73-3.232-5.298-6.592-2.569-3.359-4.97-6.845-2.403-3.482-4.63-7.08-2.231-3.594-4.282-7.295-2.046-3.702-3.916-7.5-1.865-3.794-3.545-7.676-1.675-3.887-3.164-7.847-1.484-3.96-2.778-7.988-1.29-4.028-2.383-8.115-1.09-4.087-1.983-8.223-.888-4.136-1.577-8.31-.688-4.175-1.172-8.38-.483-4.204-.761-8.422-.274-4.224-.342-8.452-.073-4.229.063-8.457.137-4.229.484-8.448.342-4.218.893-8.413.547-4.194 1.304-8.354.752-4.165 1.709-8.286.957-4.121 2.114-8.189 1.157-4.067 2.51-8.076 1.357-4.009 2.905-7.944 1.548-3.94 3.291-7.793 1.739-3.858 3.667-7.622 1.924-3.77 4.033-7.437 2.11-3.667 4.395-7.226 2.285-3.56 4.741-7.007 2.456-3.443 5.078-6.763 2.622-3.32 5.4-6.509 2.784-3.188 5.718-6.235 2.935-3.047 6.011-5.947 3.081-2.9 6.3-5.65 3.217-2.749 6.566-5.332 3.345-2.588 6.817-5.005 3.472-2.422 7.056-4.668 3.583-2.246 7.275-4.316 3.691-2.066 7.475-3.95 3.79-1.89 7.662-3.584 3.877-1.7 7.832-3.208 3.95-1.504 7.973-2.818 4.024-1.313 8.106-2.426 4.077-1.114 8.208-2.022 4.13-.913 8.305-1.621 4.17-.713 8.37-1.216Z"
        />
        {/* Window Glass */}
        <path
          fill="var(--accent-color, #FEFEFE)"
          d="M1231.127 685.444q2.837-.469 5.689-.796 2.856-.332 5.722-.517 2.872-.19 5.743-.235 2.87-.049 5.747.044 2.87.098 5.732.332 2.866.24 5.713.615 2.852.376 5.679.894 2.827.513 5.625 1.172 2.798.654 5.561 1.445 2.759.791 5.479 1.719t5.395 1.987q2.671 1.06 5.283 2.251 2.618 1.187 5.171 2.505 2.554 1.318 5.04 2.759 2.49 1.44 4.902 3.003 2.412 1.562 4.74 3.242 2.335 1.675 4.581 3.467 2.246 1.792 4.404 3.691 2.154 1.9 4.214 3.906 2.06 2.002 4.019 4.107 1.958 2.1 3.813 4.297 1.85 2.197 3.594 4.482 1.743 2.285 3.374 4.653 1.626 2.369 3.135 4.815t2.895 4.96q1.387 2.515 2.652 5.098 1.26 2.583 2.392 5.225 1.133 2.642 2.139 5.332 1 2.695 1.87 5.435.864 2.739 1.597 5.517.732 2.779 1.328 5.591.595 2.813 1.05 5.65.454 2.836.771 5.693.313 2.856.488 5.722.176 2.872.205 5.743.035 2.876-.073 5.747-.107 2.87-.361 5.732-.25 2.866-.64 5.713t-.918 5.669q-.532 2.827-1.2 5.62-.67 2.793-1.476 5.552-.8 2.759-1.743 5.473-.937 2.72-2.011 5.386-1.075 2.666-2.276 5.274-1.201 2.612-2.534 5.156-1.328 2.549-2.783 5.03-1.45 2.48-3.023 4.882-1.577 2.407-3.266 4.731-1.69 2.325-3.491 4.561-1.802 2.236-3.711 4.385-1.914 2.148-3.926 4.199-2.012 2.046-4.126 3.999-2.11 1.948-4.317 3.789-2.207 1.84-4.497 3.574-2.295 1.734-4.672 3.35-2.374 1.616-4.825 3.11-2.456 1.5-4.98 2.876-2.52 1.372-5.108 2.622-2.587 1.25-5.234 2.373-2.646 1.118-5.347 2.11-2.695.986-5.44 1.84-2.743.855-5.526 1.573-2.784.722-5.596 1.303-2.813.582-5.654 1.021-2.823.44-5.664.737-2.837.303-5.689.464-2.852.161-5.708.18-2.856.025-5.708-.097-2.856-.117-5.698-.376-2.847-.254-5.674-.654-2.827-.396-5.635-.928-2.807-.537-5.58-1.206-2.78-.674-5.518-1.48-2.74-.805-5.435-1.743-2.7-.937-5.347-2.011-2.646-1.07-5.239-2.266-2.593-1.201-5.127-2.524-2.53-1.324-4.99-2.769-2.466-1.445-4.854-3.008-2.392-1.567-4.702-3.247t-4.531-3.467q-2.227-1.792-4.36-3.691-2.139-1.894-4.175-3.896-2.041-1.998-3.98-4.097-1.938-2.095-3.774-4.282-1.836-2.193-3.56-4.468-1.723-2.275-3.335-4.634-1.61-2.358-3.105-4.79-1.494-2.436-2.871-4.941-1.372-2.5-2.622-5.069-1.25-2.568-2.373-5.195-1.118-2.627-2.115-5.308-.99-2.675-1.85-5.4-.86-2.72-1.587-5.483-.728-2.764-1.313-5.557-.591-2.793-1.045-5.615-.455-2.823-.767-5.66-.313-2.836-.488-5.688-.176-2.851-.21-5.708-.034-2.856.068-5.708.103-2.856.347-5.703.244-2.842.63-5.674.38-2.832.903-5.64.518-2.807 1.177-5.585.659-2.779 1.45-5.523.796-2.744 1.719-5.45.927-2.7 1.982-5.35 1.06-2.657 2.246-5.255 1.187-2.597 2.495-5.136 1.314-2.534 2.744-5.005 1.436-2.47 2.989-4.868 1.552-2.398 3.222-4.712 1.665-2.32 3.448-4.556 1.777-2.231 3.667-4.375 1.884-2.143 3.877-4.194 1.987-2.051 4.077-4 2.085-1.948 4.267-3.793 2.178-1.846 4.449-3.58 2.265-1.738 4.614-3.359 2.353-1.626 4.78-3.13 2.427-1.508 4.922-2.89 2.5-1.387 5.059-2.652 2.563-1.26 5.185-2.392 2.622-1.138 5.293-2.144 2.676-1.006 5.396-1.88 2.714-.869 5.473-1.61 2.759-.738 5.552-1.344 2.793-.605 5.61-1.069Z"
        />
              {/* Animated Fire */}
      <path
        ref={fireRef}
        d="M1144.936 1815.624c33.31-3.408 214.155-1.64 224.839 3.589 50.869 24.893 74.956 158.271 47.846 206.948-2.612-37.075-13.369-61.435-35.61-91.074-16.333 101.68-39.111 178.222-85.312 270.449-13.189 24.517-28.013 50.513-46.9 71.128-67.402-80.25-138.857-255.215-115.122-353.77-29.492 22.34-40.078 57.374-44.067 92.706-21.255-55.24-16.162-178.355 54.326-199.976Z"
      />
      </g>


    </svg>
    </div>
  )
}
